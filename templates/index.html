{% extends "header.html" %}
{% block head %}
<title>Blastn</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/bootstrap-filestyle.min.js"></script>
    <script type="text/javascript">
        function my() {
            var file = document.getElementById("myFile").files[0];
            var reader = new FileReader();
            reader.onload = function (e) {
                var textArea = document.getElementById("edit-fasta");
                textArea.value = e.target.result;
            };
            reader.readAsText(file);
        }
        
    </script>
    <script type="text/javascript">
        var sigString = ["> Seq1 < unknown description> "
            , "TATAATTTAACACGAACCGGCTGCAAAGCAGCATCAGCTCTATGTCCTGTACCTTGATAC AGAAGCTAGCTTCTTTTGAAATTCCTCAGCTGGTTGAGGTTGCTTGTTTTGACAGATGAA CGTGACAGGTGTTTTTTTTCGTTTTTGTTCTATTAATAGACGATGACAGATGATAGCAGC TGAGAGATTAAAGAACGTGGTAAAGTTGGTATTAGAGTTCCAGAAACCGTAACCCTAGAC TCCCAGTTTACACTAAAAAAACACGAACAAACGCCACAACAAACACGAAAGAGTCTCTAA"
            , "TTCATGAAAGGAACCA"
        ].join("\n")

        function showSig(state) {
            if (state) {
                document.getElementById("edit-fasta").value +=sigString;
            } else {
                document.getElementById("edit-fasta").value =
                    document.getElementById("edit-fasta").value
                        .replace(sigString, '');
            }

        }


    </script>
    <script>

        function validateForm() {
            var x = document.forms["myForm"]["SELECT_DB"].value;
            if (x == "" | x == "SELECT_DB") {
                alert("Database must be filled and appropriate");
                return false;
            }

            var seq = document.forms["myForm"]["fooput"].value;
            if (!seq) {
                alert("No input");
                // check there is something first of all
                return false;
            }
            seq = seq.trim();
            // split on newlines...
            var lines = seq.split('\n');
            // check for header
            if (seq[0] == '>') {
                // remove one line, starting at the first position
                lines.splice(0, 1);
                if (lines[0] == undefined) {
                    alert("Please enter nucleotide sequence in second line");
                    return false;
                }
            }
            else {
                alert("First line should start with '>' and nucleotide sequence in next line. Please refer to example data");
                //The seq string contains non-DNA characters
                return false;
            }
            // join the array back into a single string without newlines and
            // trailing or leading spaces
            seq = lines.join('').trim();

            //Search for charaters that are not G, A, T or C.
            /*if (/^[ATCG\s]+$/i.test(seq)==true)
            {
                return true
            }
            else
            {
                alert("Please enter only nucleotide sequence");
                return false
            }*/
        }
    </script>
<script>
        function loading() {
            alert("Submited Successfully!!!. This may take some time depends upon your query. Do not click anything until the results have been loaded.");
        }
</script>

{% endblock %}
{% block content %}

    <div class="container" style="width:1100px; margin-top:5%; font-family: 'Times New Roman'; font-size: large;">

        <div class="row">
            <section class="col-sm-12">
                <a id="main-content"></a>
                <h1 class="page-header">Nucleotide to Nucleotide BLAST (blastn)</h1>
                <div class="region region-content">
                    <section id="block-system-main" class="block block-system clearfix">

                        <form name="myForm" method="post" enctype="multipart/form-data" id="blast-ui-per-blast-program-form" onsubmit="return loading()" accept-charset="UTF-8">
                            <div><textarea name="texthidden" hidden>nucleotide</textarea>
                                <fieldset class="collapsible panel panel-default form-wrapper" id="edit-b">
                                    <legend class="panel-heading">
                                        <a href="#" class="panel-title fieldset-legend" data-toggle="collapse" data-target="#edit-b > .collapse">Request a New BLAST</a>
                                    </legend>
                                    <div class="panel-collapse collapse fade in">
                                        <div class="panel-body">
                                            <fieldset class="collapsible panel panel-default form-wrapper" id="edit-query">
                                                <legend class="panel-heading">
                                                    <a href="#" class="panel-title fieldset-legend" data-toggle="collapse" data-target="#edit-query > .collapse">Enter <em class="placeholder">Nucleotide</em> Query Sequence</a>
                                                </legend>
                                                <div class="panel-collapse collapse fade in">
                                                    <div class="panel-body">
                                                        <div class="help-block">Enter one or more query sequences in the text box given or use the browse button to upload a file from your local disk. The file may contain a single sequence or a list of sequences. In both cases, the data must be in <a href="http://www.ncbi.nlm.nih.gov/BLAST/blastcgihelp.shtml" target="_blank">FASTA format</a>. Please enter only the nucleotide sequence, letters other than ATCG will be ignored.</div>
                                                        <span style="float: right;">

                                                            <label class="control-label" for="edit-example-sequence"><input type="checkbox" id="showsig" onclick="showSig(this.checked)" value="1" class="form-checkbox" />Show an Example Sequence</label>

                                                        </span><div id="fasta-textarea">

                                                            <label class="control-label" for="edit-fasta">Enter FASTA sequence(s)</label><div><textarea class="form-control form-textarea" id="edit-fasta" name="fooput" cols="60" rows="5"></textarea></div>
                                                        </div>
                                                        <div id="edit-upload-ajax-wrapper">
                                                            <div>
                                                                <label class="control-label" for="edit-upload-upload">Or upload your own query FASTA:  </label>
                                                                <div id="edit-upload-upload" class="form-managed-file input-group">
                                                                    <input style="height: auto; border:solid thin #000000;" class="form-control form-file" type="file" id="myFile" size="22" />
                                                                    <span class="input-group-btn">
                                                                        <button type="button" onclick="return my()" style="height:38px;width:70px;border: solid thin #000000;font-size: 14px;" text-align: center;">Upload</button>
                                                                    </span>
                                                                </div><div>
                                                                    <br><p>
                                                                        The file should be a plain-text FASTA
                                                                        (.fasta, .fna, .fa, .fas) file. In other words, it cannot have formatting as is the
                                                                        case with MS Word (.doc, .docx) or Rich Text Format (.rtf). It cannot be greater
                                                                        than <em>500MB</em> in size. <strong>
                                                                            Don't forget to press the Upload button before
                                                                            attempting to submit your BLAST.
                                                                        </strong>
                                                                    </p>

                                                                </div>
                                                            </div>
                                                            <fieldset class="collapsible panel panel-default form-wrapper" id="edit-db">
                                                                <legend class="panel-heading">
                                                                    <a href="#" class="panel-title fieldset-legend" data-toggle="collapse" data-target="#edit-db > .collapse">Choose Search Target</a>
                                                                </legend>
                                                                <div class="panel-collapse collapse fade in">
                                                                    <div class="panel-body">
                                                                        <div class="help-block">Choose from one of the <em>nucleotide</em> BLAST databases listed below. </div>    <div class="form-item form-item-select-db form-type-select form-group">
                                                                            <label for="edit-select-db"><em class="placeholder">Nucleotide</em> BLAST Databases:</label>

                                                                            <select id="edit-select-db" name="SELECT_DB"><option value="SELECT_DB">SELECT a Dataset</option><optgroup label="Mango genome"><option value="PAKISTANLANGRA">Mangifera Indica L. Pakistan (cultivar: Langra)</option>
                                                                                                                                                                                <option value="CHINAZILLNUCLEOTIDE">Mangifera Indica L. China (cultivar: Zill)</option><option value="ISRAELKEITTNUCLEOTIDE">Mangifera Indica L. Israel (cultivar: Keitt)</option><option value="MEXICOKENTNUCLEOTIDE">Mangifera Indica L. Mexico (cultivar: Kent)</option></optgroup></select>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                            </fieldset>
                                                            <fieldset class="collapsible collapsed panel panel-default form-wrapper" id="edit-alg">
                                                                <legend class="panel-heading">
                                                                    <a class="panel-title fieldset-legend" data-toggle="collapse" data-target="#edit-alg > .collapse">Advanced Options</a>
                                                                </legend>
                                                                <div class="panel-collapse collapse fade">
                                                                    <div class="panel-body">
                                                                        <div class="panel-body">
                                                                            <div class="form-item form-item-maxtarget form-type-select form-group">
                                                                                <label class="control-label" for="edit-maxtarget">Max target sequences</label>
                                                                                <select class="form-control form-select" title="Select the maximum number of unique target sequences per query sequence to show results for." data-toggle="tooltip" id="edit-maxtarget" name="maxTarget"><option value="500" selected="selected"> </option><option value="10">10</option><option value="50">50</option><option value="100">100</option><option value="250">250</option><option value="500">500</option><option value="1000">1000</option><option value="5000">5000</option><option value="10000">10000</option><option value="20000">20000</option></select>
                                                                            </div><div class="form-item form-item-eval form-type-textfield form-group">
                                                                                <label class="control-label" for="edit-eval">e-Value (Expected Threshold)</label>
                                                                                <input class="form-control form-text" type="text" id="edit-eval" name="eVal" value="0.001" size="12" maxlength="20" /><div class="help-block">Expected number of chance matches in a random model. This number should be give in a decimal format.</div>
                                                                            </div><div class="form-item form-item-wordsize form-type-select form-group">
                                                                                <label class="control-label" for="edit-wordsize">Word size</label>
                                                                                <select class="form-control form-select" title="The length of the seed that initiates an alignment" data-toggle="tooltip" id="edit-wordsize" name="wordSize"><option value="11" selected="selected">11</option><option value="15">15</option><option value="16">16</option><option value="20">20</option><option value="24">24</option><option value="28">28</option><option value="32">32</option><option value="48">48</option><option value="64">64</option><option value="128">128</option><option value="256">256</option></select>
                                                                            </div>
                                                                            <div class="form-item form-item-mmscores form-type-select form-group">
                                                                                <label class="control-label" for="edit-mmscores">Match/Mismatch Scores</label>
                                                                                <select class="form-control form-select" title="Reward and penalty for matching and mismatching bases." data-toggle="tooltip" id="edit-mmscores" name="MScores"><option value="1,-2">1,-2</option><option value="1,-3">1,-3</option><option value="1,-4">1,-4</option><option value="2,-3">2,-3</option><option value="4,-5">4,-5</option><option value="1,-1">1,-1</option></select>
                                                                            </div><div class="form-item form-item-gapcost form-type-select form-group">
                                                                                <label class="control-label" for="edit-gapcost">Gap Costs </label>
                                                                                <select class="form-control form-select" title="Cost to create and extend a gap in an alignment. Linear costs are available only with megablast and are determined by the match/mismatch scores." data-toggle="tooltip" id="edit-gapcost1" name="gapCost1"><option value="5,2" selected="selected">Existence: 5 Extention: 2</option><option value="2,2">Existence: 2 Extention: 2</option><option value="1,2">Existence: 1 Extention: 2</option><option value="0,2">Existence: 0 Extention: 2</option><option value="3,1">Existence: 3 Extention: 1</option><option value="2,1">Existence: 2 Extention: 1</option><option value="1,1">Existence: 1 Extention: 1</option></select>
                                                                            </div><div class="form-item form-item-gapcost form-type-select form-group">
                                                                                <label class="control-label" for="edit-gapcost">Percent identity cutoff </label>
                                                                                <select class="form-control form-select" title="Percent Identity cutoff." data-toggle="tooltip" id="edit-gapcost1" name="periden"><option value="0" selected="selected">0</option><option value="20">20</option><option value="30">30</option><option value="40">40</option><option value="50">50</option><option value="60">60</option><option value="70">70</option><option value="75">75</option><option value="80">80</option><option value="85">85</option><option value="90">90</option><option value="95">95</option><option value="100">100</option></select>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </fieldset>

                                                            
                                                            <input formaction="/blas" type="submit"  value="Blast" class="btn btn-default form-submit" onclick="return validateForm()" />


                                                        </div>
                                                    </div>
                                                </div>
                                            </fieldset>
                                        </div>
                                    </div>
                                </fieldset>
                            </div>
                        </form>
                    </section>
                </div>
            </section>
        </div>
    </div>
{% endblock %}
